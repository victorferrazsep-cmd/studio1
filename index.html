<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="assets/icon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o Studio Sa Lopes</title>

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.global.min.js"></script>

<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<!-- Manifest (PWA) -->
<link rel="manifest" href="manifest.json">

<style>
  :root {
    --fundo: #1e1e1e;
    --rose: #f4bfae;
    --texto: #ffffff;
  }

  body {
    background-color: var(--fundo);
    color: var(--texto);
    font-family: 'Inter', sans-serif;
  }

  .sidebar {
    background-color: #111111;
    color: var(--rose);
    transition: transform 0.3s ease;
  }

  .sidebar a {
    display: block;
    padding: 12px 20px;
    border-radius: 8px;
    color: var(--rose);
    text-decoration: none;
    margin-bottom: 4px;
    transition: background 0.2s;
  }

  .sidebar a:hover, .sidebar a.active {
    background-color: var(--rose);
    color: #111111;
  }

  .sidebar.hidden { transform: translateX(-100%); }

  .card {
    background-color: #2b2b2b;
    color: var(--rose);
    border: 1px solid #3a3a3a;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 50;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center; align-items: center;
  }

  .modal-content {
    background: #2b2b2b;
    color: var(--rose);
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 800px;
    max-height: 90%;
    overflow-y: auto;
  }

  .btn-primary {
    background-color: var(--rose);
    color: #111;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #ffd2c2;
  }
</style>
</head>
<body class="flex h-screen">

<!-- Sidebar -->
<aside id="sidebar" class="sidebar w-64 p-5 flex flex-col fixed inset-y-0 left-0 z-40 hidden">
  <h1 class="text-2xl font-semibold mb-8 text-center">üíÖ Studio Sa Lopes</h1>
  <nav class="flex flex-col space-y-2">
    <a href="#" class="active" data-page="home">Home</a>
    <a href="#" data-page="clientes">Clientes</a>
    <a href="#" data-page="agenda">Agenda</a>
    <a href="#" data-page="financeiro">Financeiro</a>
    <a href="#" data-page="configuracoes">Configura√ß√µes</a>
    <a href="#" data-page="teste">Teste</a>
  </nav>
</aside>

<!-- Bot√£o de menu -->
<button id="menuBtn" class="absolute top-5 left-5 p-2 rounded-md shadow-md z-50">
  <span style="color: var(--rose);" class="text-2xl">‚ò∞</span>
</button>

<!-- Conte√∫do principal -->
<main class="flex-1 p-10 overflow-y-auto ml-0">

  <!-- HOME -->
  <div id="homePage" class="page">
    <div class="text-center mb-8">
      <img src="assets/logo.png" alt="Logo Studio Sa Lopes" class="mx-auto mb-4" style="width:320px;" onerror="this.onerror=null;this.src='https://via.placeholder.com/320x160?text=Logo';">
      <h2 class="text-3xl font-bold text-rose-300" style="display:none;">Gest√£o Studio Sa Lopes</h2>
    </div>

    <div class="grid grid-cols-3 gap-5 mb-5">
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="atendimentos">Atendimentos: 0</div>
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="agendamentos">Agendamentos: 0</div>
      <div class="card p-5 rounded-xl shadow grid grid-rows-2 text-center font-bold">
        <div id="primeiraVez">Primeira Vez: 0</div>
        <div id="manutencao">Manuten√ß√µes: 0</div>
      </div>
    </div>

    <div class="card rounded-xl shadow p-5 mb-5">
      <div id="calendar" class="w-full" style="height: 400px;"></div>
    </div>

    <div class="card rounded-xl shadow p-5 flex flex-col justify-center" id="resumoFinanceiro">
      <h3 class="text-lg font-bold mb-4">Financeiro</h3>
      <div class="grid grid-cols-3 gap-5">
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoReceita">Receita: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoDespesa">Despesa: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoSaldo">Saldo: R$0</div>
      </div>
    </div>
  </div>

  <!-- CLIENTES -->
  <div id="clientesPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Clientes</h2>
      <button id="btnAdicionarCliente" class="btn-primary px-4 py-2 rounded-md mr-4">Adicionar Cliente</button>
    </div>
    <div class="mb-5 ml-4">
      <label class="block mb-2 font-semibold text-rose-300">Filtro por Status:</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="todos" checked class="mr-2">
          Todos
        </label>
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="Ativo" class="mr-2">
          Ativo
        </label>
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="Inativo" class="mr-2">
          Inativo
        </label>
      </div>
    </div>
    <div id="boxCliente" class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto hidden">
      <h2 id="tituloCliente" class="text-xl font-bold mb-4 text-rose-300">Cadastro de Cliente</h2>
      <form id="formCliente" class="space-y-4">
        <div>
          <label class="block mb-1 font-semibold" for="clienteNome">NOME</label>
          <input type="text" id="clienteNome" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteCpf">CPF</label>
          <input type="text" id="clienteCpf" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteTelefone">TELEFONE</label>
          <input type="text" id="clienteTelefone" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteDn">DN</label>
          <input type="date" id="clienteDn" name="dn" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteEnderecoNum">ENDERE√áO_NUM</label>
          <input type="text" id="clienteEnderecoNum" name="endereco_num" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteCep">CEP</label>
          <input type="text" id="clienteCep" name="cep" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteInstagram">INSTAGRAM</label>
          <input type="text" id="clienteInstagram" name="instagram" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300">
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteStatus">STATUS</label>
          <select id="clienteStatus" name="status" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            <option value="Ativo">Ativo</option>
            <option value="Inativo">Inativo</option>
          </select>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button type="button" id="fecharBoxCliente" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
          <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
        </div>
      </form>
    </div>
    <div class="mt-6 ml-4">
      <div id="listaClientes" class="space-y-4">
      </div>
    </div>
  </div>

  <!-- AGENDA -->
  <div id="agendaPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Agenda</h2>
      <div class="relative mr-4">
        <button id="btnAnamnese" class="btn-primary px-4 py-2 rounded-md">Adicionar Anamnese</button>
        <div id="boxAnamnese" class="absolute right-0 mt-2 w-96 card rounded-xl shadow p-5 z-50 hidden">
          <h2 class="text-xl font-bold mb-4 text-rose-300">Cadastro de Anamnese</h2>
          <form id="formAnamneseBox" class="space-y-4">
            <div>
              <label class="block mb-1 font-semibold" for="anamneseNomeBox">Nome</label>
              <input type="text" id="anamneseNomeBox" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseCpfBox">CPF</label>
              <input type="text" id="anamneseCpfBox" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseEnderecoBox">Endere√ßo</label>
              <input type="text" id="anamneseEnderecoBox" name="endereco" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseTelefoneBox">Telefone</label>
              <input type="text" id="anamneseTelefoneBox" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseEmailBox">Email</label>
              <input type="email" id="anamneseEmailBox" name="email" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div class="flex justify-end gap-3 mt-6">
              <button type="button" id="fecharBoxAnamnese" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
              <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="calendarAgenda" class="w-full" style="height: 600px;"></div>
    <div id="boxAnamnese" class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto hidden">
      <h2 class="text-xl font-bold mb-4 text-rose-300">Cadastro de Anamnese</h2>
      <form id="formAnamneseBox" class="space-y-4">
        <div>
          <label class="block mb-1 font-semibold" for="anamneseNomeBox">Nome</label>
          <input type="text" id="anamneseNomeBox" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseCpfBox">CPF</label>
          <input type="text" id="anamneseCpfBox" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseEnderecoBox">Endere√ßo</label>
          <input type="text" id="anamneseEnderecoBox" name="endereco" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseTelefoneBox">Telefone</label>
          <input type="text" id="anamneseTelefoneBox" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseEmailBox">Email</label>
          <input type="email" id="anamneseEmailBox" name="email" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button type="button" id="fecharBoxAnamnese" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
          <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- FINANCEIRO -->
  <div id="financeiroPage" class="page hidden">
    <h2 class="text-2xl font-bold mb-5 text-rose-300 ml-4">Financeiro</h2>
    <div class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto">
        <form class="space-y-4">
            <div>
                <label class="block mb-1 font-semibold" for="financeiroNome">NOME</label>
                <input type="text" id="financeiroNome" name="Nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
                <label class="block mb-1 font-semibold" for="financeiroCPF">CPF</label>
                <input type="text" id="financeiroCPF" name="CPF" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
                <label class="block mb-1 font-semibold" for="financeiroTelefone">TELEFONE</label>
                <input type="text" id="financeiroTelefone" name="Telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div class="flex justify-end mt-6">
                <button type="submit" class="btn-primary px-4 py-2 rounded-md">Enviar</button>
            </div>
        </form>
    </div>
  </div>

  <!-- CONFIGURA√á√ïES -->
  <div id="configuracoesPage" class="page hidden">
    <h2 class="text-2xl font-bold mb-5 text-rose-300 ml-4">Configura√ß√µes</h2>
    <div class="card rounded-xl shadow p-5 max-w-xl mx-auto">
      <h3 class="text-lg font-bold mb-4">Gerenciamento de Arquivos</h3>
      <div class="mb-4">
        <button id="selectDirBtn" class="btn-primary px-4 py-2 rounded-md">Selecionar Diret√≥rio</button>
        <p id="selectedDir" class="mt-2 text-sm">Diret√≥rio selecionado: Nenhum</p>
      </div>
      <div class="mb-4">
        <button id="exportCSVBtn" class="btn-primary px-4 py-2 rounded-md">Exportar Clientes para CSV</button>
      </div>
      <div class="mb-4">
        <input type="file" id="importCSVInput" accept=".csv" class="hidden">
        <button id="importCSVBtn" class="btn-primary px-4 py-2 rounded-md">Importar Clientes de CSV</button>
      </div>
    </div>
  </div>

  <!-- TESTE -->
  <div id="testePage" class="page hidden">
    <h2 class="text-2xl font-bold mb-5 text-rose-300 ml-4">Teste</h2>
    <button id="btnAdicionarTeste" class="btn-primary px-4 py-2 rounded-md ml-4">Adicionar</button>
    <div id="boxTeste" class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto hidden">
      <form id="formClienteTeste" style="color:#f5c5b5; background:#2b2b2b; padding:20px; border-radius:12px; max-width:400px; font-family:sans-serif;">
        <h3 style="margin-bottom:16px;">Cadastro de Cliente</h3>

        <label>Nome:</label><br>
        <input type="text" id="nomeTeste" required style="width:100%; margin-bottom:12px; padding:8px; border-radius:6px; border:none; background:#3a3a3a; color:#f5c5b5;"><br>

        <label>CPF:</label><br>
        <input type="text" id="cpfTeste" required style="width:100%; margin-bottom:12px; padding:8px; border-radius:6px; border:none; background:#3a3a3a; color:#f5c5b5;"><br>

        <label>Telefone:</label><br>
        <input type="tel" id="telefoneTeste" required style="width:100%; margin-bottom:16px; padding:8px; border-radius:6px; border:none; background:#3a3a3a; color:#f5c5b5;"><br>

        <button type="submit" style="background:#f5c5b5; color:#1e1e1e; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:bold;">
          Enviar
        </button>
      </form>
    </div>
  </div>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyrQlcKg1G6S24Cb7Hw9774O7yjMpvEf1Cce8DNjcEt1U27iVVq5SUAlRJFxWJwiFBaVw/exec";

let editingIndex = -1;

function salvarCliente(cliente) {
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  if (editingIndex >= 0) {
    clientes[editingIndex] = cliente;
    editingIndex = -1;
  } else {
    clientes.push(cliente);
  }
  localStorage.setItem('clientes', JSON.stringify(clientes));
}

function editarCliente(index) {
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  const cli = clientes[index];
  document.getElementById('clienteNome').value = cli.nome || '';
  document.getElementById('clienteCpf').value = cli.cpf || '';
  document.getElementById('clienteTelefone').value = cli.telefone || '';
  document.getElementById('clienteDn').value = cli.dn || '';
  document.getElementById('clienteEnderecoNum').value = cli.endereco_num || '';
  document.getElementById('clienteCep').value = cli.cep || '';
  document.getElementById('clienteInstagram').value = cli.instagram || '';
  document.getElementById('clienteStatus').value = cli.status || 'Ativo';
  document.getElementById('tituloCliente').textContent = 'Editar Cliente';
  editingIndex = index;
  document.getElementById('boxCliente').classList.remove('hidden');
}

function excluirCliente(index) {
  if (confirm('Tem certeza que deseja excluir este cliente?')) {
    let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    clientes.splice(index, 1);
    localStorage.setItem('clientes', JSON.stringify(clientes));
    carregarClientes();
  }
}

function carregarClientes(){
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  let filteredClientes = [...clientes];
  const filtro = document.querySelector('input[name="filtroStatus"]:checked').value;
  if (filtro !== 'todos') {
    filteredClientes = clientes.filter(cli => cli.status === filtro);
  }
  const container = document.getElementById("listaClientes");
  container.innerHTML = "";
  filteredClientes.forEach((cli)=>{
    const originalIndex = clientes.indexOf(cli);
    const card = document.createElement("div");
    card.className = "flex items-center bg-[#2b2b2b] text-[#f5c5b5] shadow-md rounded-xl p-4 w-full max-w-3xl mb-4";
    card.innerHTML = `
      <!-- Esquerda: Avatar e informa√ß√µes -->
      <div class="flex items-center gap-4 flex-1">
        <!-- Avatar -->
        <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#f5c5b5] text-[#1e1e1e] text-xl font-semibold border-2 border-[#f5c5b5]">
          ${cli.nome ? cli.nome.charAt(0).toUpperCase() : 'U'}
        </div>

        <!-- Informa√ß√µes -->
        <div>
          <h2 class="font-semibold text-[#f5c5b5]">${cli.nome || 'Nome n√£o informado'} <span class="inline-block w-3 h-3 rounded-full ${cli.status === 'Ativo' ? 'bg-green-500' : 'bg-red-500'}"></span></h2>
          <div class="text-xs text-[#f5c5b5]/80">
            <p>
              <span class="block">${cli.instagram ? '@' + cli.instagram : 'Instagram n√£o informado'}</span>
              <span class="block">üìû ${cli.telefone || 'Telefone n√£o informado'}</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Centro: Dados adicionais -->
      <div class="text-xs text-[#f5c5b5] text-right flex-1 mx-4">
        <p>${cli.dn ? new Date(cli.dn).toLocaleDateString('pt-BR') : 'DN n√£o informado'} &nbsp;&nbsp;&nbsp; CEP ${cli.cep || 'n√£o informado'}</p>
        <p>${cli.endereco_num || 'Endere√ßo n√£o informado'}</p>
      </div>

      <!-- Direita: Bot√µes -->
      <div class="w-1/5 flex flex-col gap-2">
        <div class="grid grid-cols-2 gap-1">
          <!-- WhatsApp -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-full p-2 text-xs" onclick="window.open('https://wa.me/55${cli.telefone}','_blank')">
            <i class="fab fa-whatsapp text-[#f5c5b5]"></i>
          </button>

          <!-- Editar -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-md p-2 text-xs" onclick="editarCliente(${originalIndex})">
            <i class="fas fa-edit text-[#f5c5b5]"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-1">
          <!-- Excluir -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-md p-2 text-xs" onclick="excluirCliente(${originalIndex})">
            <i class="fas fa-trash text-[#f5c5b5]"></i>
          </button>

          <!-- Anamnese -->
          <button class="flex items-center justify-center bg-[#f5c5b5]/20 hover:bg-[#f5c5b5]/30 text-[#f5c5b5] rounded-md p-2 text-xs" onclick="alert('Anamnese de ${cli.nome}')">
            <i class="fas fa-clipboard text-[#f5c5b5]"></i>
          </button>
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded", function() {
    // L√≥gica para mostrar/esconder o formul√°rio dentro do bot√£o
    const btnAnamnese = document.getElementById("btnAnamnese");
    const boxAnamnese = document.getElementById("boxAnamnese");
    btnAnamnese.addEventListener("click", function(e) {
      e.stopPropagation();
      boxAnamnese.classList.toggle("hidden");
    });
    document.addEventListener("click", function(e) {
      if (!boxAnamnese.classList.contains("hidden")) {
        const isClickInside = boxAnamnese.contains(e.target) || btnAnamnese.contains(e.target);
        if (!isClickInside) boxAnamnese.classList.add("hidden");
      }
    });
    document.getElementById("fecharBoxAnamnese").addEventListener("click", function() {
      boxAnamnese.classList.add("hidden");
    });
    document.getElementById("formAnamneseBox").addEventListener("submit", function(e) {
      e.preventDefault();
      alert("‚úÖ Anamnese salva!");
      boxAnamnese.classList.add("hidden");
      this.reset();
    });
    // L√≥gica para mostrar/esconder o formul√°rio de cliente
    const btnAdicionarCliente = document.getElementById("btnAdicionarCliente");
    const boxCliente = document.getElementById("boxCliente");
    btnAdicionarCliente.addEventListener("click", function(e) {
      e.stopPropagation();
      editingIndex = -1;
      document.getElementById('formCliente').reset();
      document.getElementById('tituloCliente').textContent = 'Cadastro de Cliente';
      boxCliente.classList.toggle("hidden");
    });
    document.addEventListener("click", function(e) {
      if (!boxCliente.classList.contains("hidden")) {
        const isClickInside = boxCliente.contains(e.target) || btnAdicionarCliente.contains(e.target);
        if (!isClickInside) boxCliente.classList.add("hidden");
      }
    });
    document.getElementById("fecharBoxCliente").addEventListener("click", function() {
      boxCliente.classList.add("hidden");
    });
    document.getElementById("formCliente").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const cliente = {
        nome: formData.get('nome'),
        cpf: formData.get('cpf'),
        telefone: formData.get('telefone'),
        dn: formData.get('dn'),
        endereco_num: formData.get('endereco_num'),
        cep: formData.get('cep'),
        instagram: formData.get('instagram'),
        status: formData.get('status')
      };
      salvarCliente(cliente);
      alert("‚úÖ Cliente salvo!");
      boxCliente.classList.add("hidden");
      this.reset();
      carregarClientes();
    });
    // L√≥gica para mostrar/esconder o formul√°rio de teste
    const btnAdicionarTeste = document.getElementById("btnAdicionarTeste");
    const boxTeste = document.getElementById("boxTeste");
    btnAdicionarTeste.addEventListener("click", function(e) {
      e.stopPropagation();
      boxTeste.classList.toggle("hidden");
    });
    document.addEventListener("click", function(e) {
      if (!boxTeste.classList.contains("hidden")) {
        const isClickInside = boxTeste.contains(e.target) || btnAdicionarTeste.contains(e.target);
        if (!isClickInside) boxTeste.classList.add("hidden");
      }
    });
    document.getElementById("formClienteTeste").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        nome: document.getElementById("nomeTeste").value,
        cpf: document.getElementById("cpfTeste").value,
        telefone: document.getElementById("telefoneTeste").value
      };
      // Proxy que remove bloqueio de CORS
      const proxyURL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(API_URL);
      fetch(proxyURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(() => alert("‚úÖ Enviado com sucesso!"))
      .catch(() => alert("‚ùå Erro ao enviar"));
    });

    // L√≥gica para o formul√°rio Financeiro
    const formFinanceiro = document.getElementById("financeiroPage").querySelector('form');
    formFinanceiro.addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        Nome: document.getElementById("financeiroNome").value,
        CPF: document.getElementById("financeiroCPF").value,
        Telefone: document.getElementById("financeiroTelefone").value
      };
      const financeiroApiUrl = "https://api.sheetbest.com/sheets/8846f338-a3ea-446c-894b-31fc8ada7191";
      const proxyURL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(financeiroApiUrl);
      
      fetch(proxyURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(() => {
        alert("‚úÖ Enviado com sucesso!");
        formFinanceiro.reset();
      })
      .catch(() => alert("‚ùå Erro ao enviar"));
    });
    
    // Filtros de status
    document.querySelectorAll('input[name="filtroStatus"]').forEach(radio => {
      radio.addEventListener('change', carregarClientes);
    });
  const sidebar = document.getElementById("sidebar");
  const menuBtn = document.getElementById("menuBtn");
  menuBtn.addEventListener("click", function(e) {
    sidebar.classList.toggle("hidden");
    e.stopPropagation();
  });

  // Fecha o menu ao clicar fora da sidebar ou do bot√£o
  document.addEventListener("click", function(e) {
    if (!sidebar.classList.contains("hidden")) {
      const isClickInsideSidebar = sidebar.contains(e.target);
      const isClickOnMenuBtn = menuBtn.contains(e.target);
      if (!isClickInsideSidebar && !isClickOnMenuBtn) {
        sidebar.classList.add("hidden");
      }
    }
  });
  const pages = document.querySelectorAll(".page");
  document.querySelectorAll(".sidebar a").forEach(a=>{
    a.addEventListener("click", e=>{
      e.preventDefault();
      pages.forEach(p=>p.classList.add("hidden"));
      document.getElementById(a.dataset.page+"Page").classList.remove("hidden");
      document.querySelectorAll(".sidebar a").forEach(x=>x.classList.remove("active"));
      a.classList.add("active");
      if(a.dataset.page==="clientes") carregarClientes();
      if(a.dataset.page==="home") renderHomeCalendar();
    });
  });

  let homeCalendar;
  function renderHomeCalendar() {
    const calendarEl = document.getElementById("calendar");
    if (!calendarEl) return;
    if (homeCalendar) {
      homeCalendar.destroy();
    }
    homeCalendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      dateClick: info => {
        const nome = prompt("Nome do Cliente:");
        if (nome) addAgendamento(info.dateStr, nome);
      }
    });
    homeCalendar.render();
  }
  renderHomeCalendar();

  const agendaCalendar = new FullCalendar.Calendar(document.getElementById("calendarAgenda"), {
    initialView:"dayGridMonth"
  });
  agendaCalendar.render();

  async function addAgendamento(data, cliente){
    const agendamento={tipo:"agendamento",data,hora:"09:00",cliente,servico:"C√≠lios"};
    await fetch(API_URL,{method:"POST",body:JSON.stringify(agendamento),headers:{"Content-Type":"application/json"}});
    alert("‚úÖ Agendamento salvo!");
    atualizarHome();
  }

  async function atualizarHome(){
    const res=await fetch(API_URL);
    const data=await res.json();
    document.getElementById("atendimentos").innerText=`Atendimentos: ${data.agendamentos?.length||0}`;
  }

  // Configura√ß√µes - Gerenciamento de Arquivos
  let selectedDirHandle = null;

  document.getElementById("selectDirBtn").addEventListener("click", async () => {
    try {
      if ('showDirectoryPicker' in window) {
        selectedDirHandle = await window.showDirectoryPicker();
        document.getElementById("selectedDir").textContent = `Diret√≥rio selecionado: ${selectedDirHandle.name}`;
      } else {
        alert("Seu navegador n√£o suporta sele√ß√£o de diret√≥rio. Use um navegador moderno como Chrome.");
      }
    } catch (err) {
      console.error("Erro ao selecionar diret√≥rio:", err);
    }
  });

  document.getElementById("exportCSVBtn").addEventListener("click", () => {
    const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    if (clientes.length === 0) {
      alert("Nenhum cliente para exportar.");
      return;
    }
    const csvContent = "Nome,CPF,Telefone,DN,Endereco_Num,CEP,Instagram,Status\n" +
      clientes.map(cli => `"${cli.nome || ''}","${cli.cpf || ''}","${cli.telefone || ''}","${cli.dn || ''}","${cli.endereco_num || ''}","${cli.cep || ''}","${cli.instagram || ''}","${cli.status || ''}"`).join("\n");
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'clientes.csv';
    a.click();
    URL.revokeObjectURL(url);
    alert("‚úÖ CSV exportado!");
  });

  document.getElementById("importCSVBtn").addEventListener("click", () => {
    document.getElementById("importCSVInput").click();
  });

  document.getElementById("importCSVInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      const csv = event.target.result;
      const lines = csv.split('\n');
      const headers = lines[0].split(',');
      const clientes = [];
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        if (values.length >= 8) {
          clientes.push({
            nome: values[0].replace(/"/g, ''),
            cpf: values[1].replace(/"/g, ''),
            telefone: values[2].replace(/"/g, ''),
            dn: values[3].replace(/"/g, ''),
            endereco_num: values[4].replace(/"/g, ''),
            cep: values[5].replace(/"/g, ''),
            instagram: values[6].replace(/"/g, ''),
            status: values[7].replace(/"/g, '')
          });
        }
      }
      localStorage.setItem('clientes', JSON.stringify(clientes));
      carregarClientes();
      alert("‚úÖ Clientes importados!");
    };
    reader.readAsText(file);
  });
});
</script>
</body>
</html>
