 <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="assets/icon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o Studio Sa Lopes</title>

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.global.min.js"></script>

<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<!-- Manifest (PWA) -->
<link rel="manifest" href="manifest.json">

<style>
  :root {
    --fundo: #1e1e1e;
    --rose: #f4bfae;
    --texto: #ffffff;
  }

  body {
    background-color: var(--fundo);
    color: var(--texto);
    font-family: 'Inter', sans-serif;
  }

  .sidebar {
    background-color: #111111;
    color: var(--rose);
    transition: transform 0.3s ease;
  }

  .sidebar a {
    display: block;
    padding: 12px 20px;
    border-radius: 8px;
    color: var(--rose);
    text-decoration: none;
    margin-bottom: 4px;
    transition: background 0.2s;
  }

  .sidebar a:hover, .sidebar a.active {
    background-color: var(--rose);
    color: #111111;
  }

  .sidebar.hidden { transform: translateX(-100%); }

  .card {
    background-color: #2b2b2b;
    color: var(--rose);
    border: 1px solid #3a3a3a;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 50;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center; align-items: center;
  }

  .modal-content {
    background: #2b2b2b;
    color: var(--rose);
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 800px;
    max-height: 90%;
    overflow-y: auto;
  }

  .btn-primary {
    background-color: var(--rose);
    color: #111;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #ffd2c2;
  }
</style>
</head>
<body class="flex h-screen">

<!-- Sidebar -->
<aside id="sidebar" class="sidebar w-64 p-5 flex flex-col fixed inset-y-0 left-0 z-40 hidden">
  <h1 class="text-2xl font-semibold mb-8 text-center">üíÖ Studio Sa Lopes</h1>
  <nav class="flex flex-col space-y-2">
    <a href="#" class="active" data-page="home">Home</a>
    <a href="#" data-page="clientes">Clientes</a>
    <a href="#" data-page="agenda">Agenda</a>
    <a href="#" data-page="financeiro2">Financeiro</a>
  </nav>
</aside>

<!-- Bot√£o de menu -->
<button id="menuBtn" class="absolute top-5 left-5 p-2 rounded-md shadow-md z-50">
  <span style="color: var(--rose);" class="text-2xl">‚ò∞</span>
</button>

<!-- Conte√∫do principal -->
<main class="flex-1 p-10 overflow-y-auto ml-0">

  <!-- HOME -->
  <div id="homePage" class="page">
    <div class="text-center mb-8">
      <img src="assets/logo.png" alt="Logo Studio Sa Lopes" class="mx-auto mb-4" style="width:320px;" onerror="this.onerror=null;this.src='https://via.placeholder.com/320x160?text=Logo';">
      <h2 class="text-3xl font-bold text-rose-300" style="display:none;">Gest√£o Studio Sa Lopes</h2>
    </div>

    <div class="grid grid-cols-3 gap-5 mb-5">
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="atendimentos">Atendimentos: 0</div>
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="agendamentos">Agendamentos: 0</div>
      <div class="card p-5 rounded-xl shadow grid grid-rows-2 text-center font-bold">
        <div id="primeiraVez">Primeira Vez: 0</div>
        <div id="manutencao">Manuten√ß√µes: 0</div>
      </div>
    </div>

    <div class="card rounded-xl shadow p-5 mb-5">
      <div id="calendar" class="w-full" style="height: 400px;"></div>
    </div>

    <div class="card rounded-xl shadow p-5 flex flex-col justify-center" id="resumoFinanceiro">
      <h3 class="text-lg font-bold mb-4">Financeiro</h3>
      <div class="grid grid-cols-3 gap-5">
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoReceita">Receita: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoDespesa">Despesa: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoSaldo">Saldo: R$0</div>
      </div>
    </div>
  </div>

  <!-- CLIENTES -->
  <div id="clientesPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Clientes</h2>
      <button id="btnAdicionarCliente" class="btn-primary px-4 py-2 rounded-md mr-4">Adicionar Cliente</button>
    </div>
    <div class="mb-5 ml-4">
      <label class="block mb-2 font-semibold text-rose-300">Filtro por Status:</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="todos" checked class="mr-2">
          Todos
        </label>
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="Ativo" class="mr-2">
          Ativo
        </label>
        <label class="flex items-center">
          <input type="radio" name="filtroStatus" value="Inativo" class="mr-2">
          Inativo
        </label>
      </div>
    </div>
    <div id="boxCliente" class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto hidden">
      <h2 id="tituloCliente" class="text-xl font-bold mb-4 text-rose-300">Cadastro de Cliente</h2>
      <form id="formCliente" class="space-y-4">
        <div>
          <label class="block mb-1 font-semibold" for="clienteNome">NOME</label>
          <input type="text" id="clienteNome" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteCpf">CPF</label>
          <input type="text" id="clienteCpf" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteTelefone">TELEFONE</label>
          <input type="text" id="clienteTelefone" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteDn">DN</label>
          <input type="date" id="clienteDn" name="dn" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteEnderecoNum">ENDERE√áO_NUM</label>
          <input type="text" id="clienteEnderecoNum" name="endereco_num" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteCep">CEP</label>
          <input type="text" id="clienteCep" name="cep" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteInstagram">INSTAGRAM</label>
          <input type="text" id="clienteInstagram" name="instagram" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300">
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="clienteStatus">STATUS</label>
          <select id="clienteStatus" name="status" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            <option value="Ativo">Ativo</option>
            <option value="Inativo">Inativo</option>
          </select>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button type="button" id="fecharBoxCliente" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
          <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
        </div>
      </form>
    </div>
    <div class="mt-6 ml-4">
      <div id="listaClientes" class="space-y-4">
      </div>
    </div>
  </div>

  <!-- AGENDA -->
  <div id="agendaPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Agenda</h2>
      <div class="relative mr-4">
        <button id="btnAnamnese" class="btn-primary px-4 py-2 rounded-md">Adicionar Anamnese</button>
        <div id="boxAnamnese" class="absolute right-0 mt-2 w-96 card rounded-xl shadow p-5 z-50 hidden">
          <h2 class="text-xl font-bold mb-4 text-rose-300">Cadastro de Anamnese</h2>
          <form id="formAnamneseBox" class="space-y-4">
            <div>
              <label class="block mb-1 font-semibold" for="anamneseNomeBox">Nome</label>
              <input type="text" id="anamneseNomeBox" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseCpfBox">CPF</label>
              <input type="text" id="anamneseCpfBox" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseEnderecoBox">Endere√ßo</label>
              <input type="text" id="anamneseEnderecoBox" name="endereco" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseTelefoneBox">Telefone</label>
              <input type="text" id="anamneseTelefoneBox" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div>
              <label class="block mb-1 font-semibold" for="anamneseEmailBox">Email</label>
              <input type="email" id="anamneseEmailBox" name="email" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
            </div>
            <div class="flex justify-end gap-3 mt-6">
              <button type="button" id="fecharBoxAnamnese" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
              <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="calendarAgenda" class="w-full" style="height: 600px;"></div>
    <div id="boxAnamnese" class="card rounded-xl shadow p-5 mt-6 max-w-xl mx-auto hidden">
      <h2 class="text-xl font-bold mb-4 text-rose-300">Cadastro de Anamnese</h2>
      <form id="formAnamneseBox" class="space-y-4">
        <div>
          <label class="block mb-1 font-semibold" for="anamneseNomeBox">Nome</label>
          <input type="text" id="anamneseNomeBox" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseCpfBox">CPF</label>
          <input type="text" id="anamneseCpfBox" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseEnderecoBox">Endere√ßo</label>
          <input type="text" id="anamneseEnderecoBox" name="endereco" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseTelefoneBox">Telefone</label>
          <input type="text" id="anamneseTelefoneBox" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold" for="anamneseEmailBox">Email</label>
          <input type="email" id="anamneseEmailBox" name="email" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button type="button" id="fecharBoxAnamnese" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
          <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
        </div>
      </form>
    </div>
  </div>






  
    <div id="financeiro2Page" class="page hidden">
      <div class="flex justify-between items-center mb-5 max-w-xl mx-auto">
        <h2 class="text-2xl font-bold text-rose-300">Financeiro</h2>
        <div class="flex gap-3">
          <button id="btnAdicionarOcorrencia" class="btn-primary px-4 py-2 rounded-md">+ Ocorr√™ncia</button>
      <button id="btnLoadRelatorio" class="btn-primary px-4 py-2 rounded-md">Relat√≥rio</button>
        </div>
      </div>
      <div id="boxFinanceiro2" class="card rounded-xl shadow p-5 max-w-xl mx-auto hidden">
        <form id="formFinanceiro2" class="space-y-4" action="https://api.sheetbest.com/sheets/8846f338-a3ea-446c-894b-31fc8ada7191" method="post">
          <div>
            <label class="block mb-1 font-semibold" for="financeiroDtRegistro">Data de Registro</label>
            <input type="date" id="financeiroDtRegistro" name="DtRegistro" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>

          <div>
            <label class="block mb-1 font-semibold" for="financeiroTipo">Tipo</label>
            <select id="financeiroTipo" name="Tipo" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
              <option value="" disabled selected>Selecione o Tipo</option>
              <option value="Despesas">Despesas</option>
              <option value="Ganhos">Ganhos</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="financeiroFamilia">Fam√≠lia</label>
            <select id="financeiroFamilia" name="Familia" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required disabled>
              <option value="" disabled selected>Selecione a Fam√≠lia</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="financeiroNome">Nome</label>
            <select id="financeiroNome" name="Nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required disabled>
              <option value="" disabled selected>Selecione o Nome</option>
            </select>
          </div>

          <div>
            <label class="block mb-1 font-semibold" for="financeiroDescricao">Descri√ß√£o</label>
            <input type="text" id="financeiroDescricao" name="Descricao" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="financeiroValor">Valor</label>
            <input type="number" id="financeiroValor" name="Valor" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div>
<label class="block mb-1 font-semibold" for="financeiroMesRef">M√™s de Refer√™ncia</label>
<input type="month" id="financeiroMesRef" name="MesRef" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" id="fecharBoxFinanceiro2" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
            <button type="submit" class="btn-primary px-4 py-2 rounded-md">Enviar</button>
          </div>
        </form>
      </div>
<div id="relatorioFinanceiro2" class="card rounded-xl shadow p-5 mx-auto mt-6 hidden" style="width: 100%; display: flex; flex-direction: column; gap: 1rem;">
        <h3 class="text-xl font-bold mb-4 text-rose-300 flex justify-between items-center">
          Relat√≥rio Financeiro
          <input type="month" id="relatorioMesSelector" class="bg-[#1e1e1e] border border-rose-300 rounded p-1 text-rose-300 text-sm" title="Selecione o m√™s">
        </h3>
<div id="relatorioDashboard" class="grid grid-cols-3 gap-4 mb-4 max-w-full">
          <div class="card p-4 rounded-xl shadow text-center bg-[#2b2b2b] text-rose-300">
            <h4 class="font-semibold mb-2">Receita</h4>
            <p id="dashboardReceita" class="text-2xl">R$0</p>
          </div>
          <div class="card p-4 rounded-xl shadow text-center bg-[#2b2b2b] text-rose-300">
            <h4 class="font-semibold mb-2">Despesas</h4>
            <p id="dashboardDespesa" class="text-2xl">R$0</p>
          </div>
          <div class="card p-4 rounded-xl shadow text -center bg-[#2b2b2b] text-rose-300">
            <h4 class="font-semibold mb-2">Saldo</h4>
            <p id="dashboardSaldo" class="text-2xl">R$0</p>
          </div>
        </div>
<div id="relatorioResumoDetalhado" class="bg-[#2b2b2b] text-rose-300 p-4 rounded-xl shadow w-full mb-2 font-mono whitespace-pre-wrap" style="font-size: 0.85rem; max-height: 800px; overflow-y: auto;"></div>
        <div class="flex justify-end max-w-xl mb-6">
        <button id="toggleRelatorioBtn" aria-label="Expandir/Reduzir Relat√≥rio" class="font-bold text-white bg-black bg-opacity-60 hover:bg-rose-300 hover:text-[#1e1e1e] rounded transition-colors select-none" style="font-size: 1rem; padding: 0 0.5rem; line-height: 1.5; margin-left: auto;">+</button>
        </div>
<div id="relatorioContainer" class="overflow-auto" style="font-size: 0.65rem; display: none; max-height: 576px; width: 100%;">
          <!-- Report table will be inserted here -->
        </div>
      </div>
  </div>
<script>
const financeiroData = {
  'Despesas': {
    'Despesas Fixas': ['Aluguel', '√Ågua', 'Internet e Telefone', 'Outros'],
    'Despesas Vari√°veis': ['Compras de Insumos', 'Combust√≠vel'],
    'Marketing e Divulga√ß√£o': ['An√∫ncios Pagos', 'Impress√µes de Cart√µes, Panfletos e Brindes', 'Outros'],
    'Infraestrutura e Equipamentos': ['M√≥veis', 'Acess√≥rios', 'Ferramentas'],
    'Despesas Administrativas': ['Taxas Banc√°rias e Outras'],
    'Despesas Extras ou Opcionais': ['Cursos de atualiza√ß√£o e especializa√ß√£o', 'Uniformes personalizados', 'Caf√©, √°gua, snacks para o atendimento', 'Presentes em datas comemorativas']
  },
  'Ganhos': {
    'C√≠lios': ['Primeira Vez', 'Manuten√ß√£o'],
    'Sobrancelhas': ['Primeira Vez', 'Manuten√ß√£o']
  }
};

const financeiroTipo = document.getElementById('financeiroTipo');
const financeiroFamilia = document.getElementById('financeiroFamilia');
const financeiroNome = document.getElementById('financeiroNome');
const btnAdicionarOcorrencia = document.getElementById("btnAdicionarOcorrencia");
const boxFinanceiro2 = document.getElementById("boxFinanceiro2");
const btnLoadRelatorio = document.getElementById("btnLoadRelatorio");
const relatorioDiv = document.getElementById("relatorioFinanceiro2");
const relatorioContainer = document.getElementById("relatorioContainer");
const resumoDetalhadoDiv = document.getElementById("relatorioResumoDetalhado");

// New event listeners for cascading selects in financeiro2 form
financeiroTipo.addEventListener("change", () => {
  const tipo = financeiroTipo.value;
  // Clear and disable familia and nome selects initially
  financeiroFamilia.innerHTML = '<option value="" disabled selected>Selecione a Fam√≠lia</option>';
  financeiroNome.innerHTML = '<option value="" disabled selected>Selecione o Nome</option>';
  financeiroFamilia.disabled = true;
  financeiroNome.disabled = true;

  if (tipo && financeiroData[tipo]) {
    // Populate familia options
    Object.keys(financeiroData[tipo]).forEach(familia => {
      const opt = document.createElement("option");
      opt.value = familia;
      opt.textContent = familia;
      financeiroFamilia.appendChild(opt);
    });
    financeiroFamilia.disabled = false;
  }
});

financeiroFamilia.addEventListener("change", () => {
  const tipo = financeiroTipo.value;
  const familia = financeiroFamilia.value;
  // Clear and disable nome select initially
  financeiroNome.innerHTML = '<option value="" disabled selected>Selecione o Nome</option>';
  financeiroNome.disabled = true;

  if (tipo && familia && financeiroData[tipo] && financeiroData[tipo][familia]) {
    // Populate nome options
    financeiroData[tipo][familia].forEach(nome => {
      const opt = document.createElement("option");
      opt.value = nome;
      opt.textContent = nome;
      financeiroNome.appendChild(opt);
    });
    financeiroNome.disabled = false;
  }
});

// New submit event listener to prevent redirect on form submit and submit asynchronously
const formFinanceiro2 = document.getElementById("formFinanceiro2");
formFinanceiro2.addEventListener("submit", function(event) {
  event.preventDefault(); // Prevent default form submission that causes redirect

  // Gather form data
  const formData = new FormData(formFinanceiro2);

  // Convert to URLSearchParams for x-www-form-urlencoded POST or send as JSON
  // API endpoint expects form post, so send as FormData
  fetch(formFinanceiro2.action, {
    method: formFinanceiro2.method,
    body: formData,
    mode: 'cors'
  }).then(response => {
    if (response.ok) {
      alert("Registrado com sucesso.");
      formFinanceiro2.reset();
      // Optionally hide the form
      boxFinanceiro2.classList.add("hidden");
    } else {
      alert("Erro ao enviar formul√°rio. Tente novamente.");
    }
  }).catch(error => {
    alert("Erro ao enviar formul√°rio. Tente novamente.");
    console.error(error);
  });
});

btnLoadRelatorio.addEventListener("click", () => {
  relatorioContainer.innerHTML = "Carregando...";
  fetch("https://api.sheetbest.com/sheets/8846f338-a3ea-446c-894b-31fc8ada7191")
    .then(response => {
      if (!response.ok) throw new Error("Erro ao carregar o relat√≥rio");
      return response.json();
    })
    .then(data => {
      if (!data || data.length === 0) {
        relatorioContainer.innerHTML = "<p>Relat√≥rio vazio.</p>";
        return;
      }

      // Store data globally for month filtering
      window.financeiroRelatorioData = data;

      function atualizarDashboard(mesSelecionado) {
        // Filter data by selected month "YYYY-MM"
        let filtered = window.financeiroRelatorioData || [];
        if (mesSelecionado) {
          filtered = window.financeiroRelatorioData.filter(item => item["M√™s de Refer√™ncia"] === mesSelecionado);
        }

        // Aggregate sums grouped by Tipo
        let receita = 0;
        let despesa = 0;
        filtered.forEach(item => {
          const tipo = item["Tipo"];
          const valor = parseFloat(item["Valor"]) || 0;
          if (tipo === "Ganhos") receita += valor;
          else if (tipo === "Despesas") despesa += valor;
        });

        // Format values to BRL currency
        const formataValor = v => "R$" + v.toFixed(2).replace(".", ",");

        document.getElementById("dashboardReceita").textContent = formataValor(receita);
        document.getElementById("dashboardDespesa").textContent = formataValor(despesa);
        document.getElementById("dashboardSaldo").textContent = formataValor(receita - despesa);

        // Build detailed hierarchical summary grouped by Tipo > Familia > Nome
        resumoDetalhadoDiv.innerHTML = ""; // clear existing content

        // Apply white font and subtle background highlight
        resumoDetalhadoDiv.style.color = "white";
        resumoDetalhadoDiv.style.backgroundColor = "rgba(255, 255, 255, 0.05)";
        resumoDetalhadoDiv.style.padding = "1em";
        resumoDetalhadoDiv.style.borderRadius = "8px";

        // Helper to safely accumulate sums
        const acumulador = {};

        filtered.forEach(item => {
          const tipo = item["Tipo"] || "Sem Tipo";
          const familia = item["Familia"] || "Sem Fam√≠lia";
          const nome = item["Nome"] || "Sem Nome";
          const valor = parseFloat(item["Valor"]) || 0;

          if (!acumulador[tipo]) acumulador[tipo] = { total: 0, familias: {} };
          acumulador[tipo].total += valor;

          if (!acumulador[tipo].familias[familia]) acumulador[tipo].familias[familia] = { total: 0, nomes: {} };
          acumulador[tipo].familias[familia].total += valor;

          if (!acumulador[tipo].familias[familia].nomes[nome]) acumulador[tipo].familias[familia].nomes[nome] = 0;
          acumulador[tipo].familias[familia].nomes[nome] += valor;
        });

        // Helper to create a row with category left and value right with dotted leader
        function createRow(label, value, options = {}) {
          const row = document.createElement("div");
          row.style.display = "flex";
          row.style.alignItems = "center";
          row.style.marginBottom = options.marginBottom || "2px";

          // Label container flex
          const labelContainer = document.createElement("div");
          labelContainer.style.display = "flex";
          labelContainer.style.alignItems = "center";
          labelContainer.style.flexGrow = "1";

          const labelSpan = document.createElement("span");
          labelSpan.textContent = label;
          labelSpan.style.fontWeight = options.bold ? "bold" : "normal";
          labelSpan.style.fontStyle = options.italic ? "italic" : "normal";
          labelSpan.style.fontSize = options.fontSize || "1rem";
          labelSpan.style.paddingLeft = options.paddingLeft || "0";
          labelSpan.style.whiteSpace = "nowrap";
          labelSpan.style.zIndex = "1";

          // Dots filler that expands horizontally between label and value
          const dotsSpan = document.createElement("span");
          dotsSpan.style.flexGrow = "1";
          dotsSpan.style.borderBottom = "1px dotted #cccccc";
          dotsSpan.style.margin = "0 6px";

          // Value container fixed width on right
          const valueSpan = document.createElement("span");
          valueSpan.textContent = value;
          valueSpan.style.fontWeight = options.bold ? "bold" : "normal";
          valueSpan.style.whiteSpace = "nowrap";
          valueSpan.style.minWidth = "7ch";
          valueSpan.style.textAlign = "right";

          labelContainer.appendChild(labelSpan);
          labelContainer.appendChild(dotsSpan);

          row.appendChild(labelContainer);
          row.appendChild(valueSpan);

          return row;
        }

        // Iterate over Tipo groups, then Familias, then Nomes, adding subtotal and total lines with separators
        let grandTotal = 0;

        for (const tipoKey in acumulador) {
          const tipoTotal = formataValor(acumulador[tipoKey].total);
          // Add a separator line for Tipo groups except first
          if (resumoDetalhadoDiv.childElementCount > 0) {
            const hr = document.createElement("hr");
            hr.style.border = "none";
            hr.style.borderTop = "1px solid #cccccc";
            hr.style.margin = "10px 0";
            resumoDetalhadoDiv.appendChild(hr);
          }
          resumoDetalhadoDiv.appendChild(createRow(tipoKey.toUpperCase(), tipoTotal, { bold: true, marginBottom: "6px" }));

          const familias = acumulador[tipoKey].familias;
          for (const famKey in familias) {
            const famTotal = formataValor(familias[famKey].total);
            resumoDetalhadoDiv.appendChild(createRow("‚îî " + famKey, famTotal, { fontSize: "0.875rem", paddingLeft: "1rem", marginBottom: "4px" }));

            const nomes = familias[famKey].nomes;
            for (const nomeKey in nomes) {
              const nomeTotal = formataValor(nomes[nomeKey]);
            resumoDetalhadoDiv.appendChild(createRow("   ‚îî " + nomeKey, nomeTotal, { paddingLeft: "2rem", marginBottom: "2px", bold: true }));
            }

            // Add Familia subtotal separator line with background
            const famSubtotalContainer = document.createElement("div");
            famSubtotalContainer.style.backgroundColor = "rgba(204, 204, 204, 0.1)";
            famSubtotalContainer.style.padding = "2px 6px";
            famSubtotalContainer.style.marginBottom = "10px";
            famSubtotalContainer.style.borderRadius = "4px";
            
            const famSubtotalHr = document.createElement("hr");
            famSubtotalHr.style.border = "none";
            famSubtotalHr.style.borderTop = "1px dotted #cccccc";
            famSubtotalHr.style.margin = "0 0 0 1rem";
            famSubtotalContainer.appendChild(famSubtotalHr);

            resumoDetalhadoDiv.appendChild(famSubtotalContainer);
          }

          grandTotal += acumulador[tipoKey].total;
        }

        // Add grand total line after all Tipos with background
        const grandTotalContainer = document.createElement("div");
        grandTotalContainer.style.backgroundColor = "rgba(204, 204, 204, 0.2)";
        grandTotalContainer.style.borderRadius = "6px";
        grandTotalContainer.style.padding = "6px 10px";
        grandTotalContainer.style.margin = "12px 0";

        // Removed grand total separator <hr> line as per request
        /*
        const grandTotalHr = document.createElement("hr");
        grandTotalHr.style.border = "none";
        grandTotalHr.style.borderTop = "2px solid #cccccc";
        grandTotalHr.style.margin = "0 0 6px 0";

        grandTotalContainer.appendChild(grandTotalHr);
        */

        grandTotalContainer.appendChild(createRow("TOTAL", formataValor(grandTotal), { bold: true, marginBottom: "0" }));

        resumoDetalhadoDiv.appendChild(grandTotalContainer);

        // Also update the displayed report table to show only filtered data
        relatorioContainer.innerHTML = ""; // clear existing table

        const table = document.createElement("table");
        table.className = "w-full text-left border-collapse";
        table.style.border = "none"; // Remove outer border

        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        // Reduced header cell padding for tighter rows
        const headerCellPadding = "4px 6px";

        const keys = Object.keys(filtered[0]);
        keys.forEach(key => {
          const th = document.createElement("th");
          th.textContent = key;
          th.style.border = "none"; // Remove border for cleaner look
          th.style.padding = headerCellPadding;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        // Reduced cell padding for tighter row spacing
        const cellPadding = "4px 6px";
        filtered.forEach(row => {
          const tr = document.createElement("tr");
          keys.forEach(key => {
            const td = document.createElement("td");
            td.textContent = row[key];
            td.style.border = "none"; 
            td.style.padding = cellPadding;
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        relatorioContainer.appendChild(table);
      }

      // Set dashboard and report visible
      relatorioDiv.classList.remove("hidden");
      document.getElementById("relatorioDashboard").classList.remove("hidden");

      // Set initial dashboard to first month found or current month
      let primeiroMes = data[0]["M√™s de Refer√™ncia"] || "";
      const mesSelector = document.getElementById("relatorioMesSelector");
      mesSelector.value = primeiroMes;
      atualizarDashboard(primeiroMes);
    })
    .catch(error => {
      relatorioContainer.innerHTML = `<p class="text-red-500">${error.message}</p>`;
    });
});


const toggleBtn = document.getElementById("toggleRelatorioBtn");

toggleBtn.addEventListener("click", () => {
  const expanded = relatorioContainer.style.display !== "none";
  if (expanded) {
    // Collapse only the report table (spreadsheet)
    relatorioContainer.style.display = "none";
    toggleBtn.textContent = "+";
    toggleBtn.style.backgroundColor = "rgba(0, 0, 0, 0.3)";
    toggleBtn.style.color = "var(--rose)";
  } else {
    // Expand report table
    relatorioContainer.style.display = "block";
    toggleBtn.textContent = "‚àí"; // minus sign
    toggleBtn.style.backgroundColor = "rgba(204, 204, 204, 0.3)";
    toggleBtn.style.color = "#111"; // dark text
  }
});

document.getElementById("relatorioMesSelector").addEventListener("change", (e) => {
  const mes = e.target.value;
  if (window.financeiroRelatorioData) {
    atualizarDashboard(mes);
  }
});


// Add listener for month selector change
function atualizarDashboard(mesSelecionado) {
  // Filter data by selected month "YYYY-MM"
  let filtered = window.financeiroRelatorioData || [];
  if (mesSelecionado) {
    filtered = window.financeiroRelatorioData.filter(item => item["M√™s de Refer√™ncia"] === mesSelecionado);
  }

  // Aggregate sums grouped by Tipo
  let receita = 0;
  let despesa = 0;
  filtered.forEach(item => {
    const tipo = item["Tipo"];
    const valor = parseFloat(item["Valor"]) || 0;
    if (tipo === "Ganhos") receita += valor;
    else if (tipo === "Despesas") despesa += valor;
  });

  // Format values to BRL currency
  const formataValor = v => "R$" + v.toFixed(2).replace(".", ",");

  document.getElementById("dashboardReceita").textContent = formataValor(receita);
  document.getElementById("dashboardDespesa").textContent = formataValor(despesa);
  document.getElementById("dashboardSaldo").textContent = formataValor(receita - despesa);

  // Build detailed hierarchical summary grouped by Tipo > Familia > Nome
  // const resumoDetalhadoDiv = document.getElementById("relatorioResumoDetalhado");
  // const relatorioContainer = document.getElementById("relatorioContainer");

  if (!filtered.length) {
    resumoDetalhadoDiv.innerHTML = "<p>Ainda n√£o tem dados aqui :(</p>";
    relatorioContainer.innerHTML = "<p>Ainda n√£o tem dados aqui :(</p>";
    resumoDetalhadoDiv.style.display = "block";
    relatorioContainer.style.display = "block";
    return;
  } else {
    resumoDetalhadoDiv.style.display = "block";
    relatorioContainer.style.display = "block";
  }

  resumoDetalhadoDiv.innerHTML = ""; // clear existing content

  // Helper to safely accumulate sums
  const acumulador = {};

  filtered.forEach(item => {
    const tipo = item["Tipo"] || "Sem Tipo";
    const familia = item["Familia"] || "Sem Fam√≠lia";
    const nome = item["Nome"] || "Sem Nome";
    const valor = parseFloat(item["Valor"]) || 0;

    if (!acumulador[tipo]) acumulador[tipo] = { total: 0, familias: {} };
    acumulador[tipo].total += valor;

    if (!acumulador[tipo].familias[familia]) acumulador[tipo].familias[familia] = { total: 0, nomes: {} };
    acumulador[tipo].familias[familia].total += valor;

    if (!acumulador[tipo].familias[familia].nomes[nome]) acumulador[tipo].familias[familia].nomes[nome] = 0;
    acumulador[tipo].familias[familia].nomes[nome] += valor;
  });

  // Helper to create a row with category left and value right with dotted leader
  function createRow(label, value, options = {}) {
    const row = document.createElement("div");
    row.style.display = "flex";
    row.style.alignItems = "center";
    row.style.marginBottom = options.marginBottom || "2px";

    // Label container flex
    const labelContainer = document.createElement("div");
    labelContainer.style.display = "flex";
    labelContainer.style.alignItems = "center";
    labelContainer.style.flexGrow = "1";

    const labelSpan = document.createElement("span");
    labelSpan.textContent = label;
    labelSpan.style.fontWeight = options.bold ? "bold" : "normal";
    labelSpan.style.fontStyle = options.italic ? "italic" : "normal";
    labelSpan.style.fontSize = options.fontSize || "1rem";
    labelSpan.style.paddingLeft = options.paddingLeft || "0";
    labelSpan.style.whiteSpace = "nowrap";
    labelSpan.style.zIndex = "1";

    // Dots filler that expands horizontally between label and value
    const dotsSpan = document.createElement("span");
    dotsSpan.style.flexGrow = "1";
    dotsSpan.style.borderBottom = "1px dotted #cccccc";
    dotsSpan.style.margin = "0 6px";

    // Value container fixed width on right
    const valueSpan = document.createElement("span");
    valueSpan.textContent = value;
    valueSpan.style.fontWeight = options.bold ? "bold" : "normal";
    valueSpan.style.whiteSpace = "nowrap";
    valueSpan.style.minWidth = "7ch";
    valueSpan.style.textAlign = "right";

    labelContainer.appendChild(labelSpan);
    labelContainer.appendChild(dotsSpan);

    row.appendChild(labelContainer);
    row.appendChild(valueSpan);

    return row;
  }

  // Iterate over Tipo groups, then Familias, then Nomes, adding subtotal and total lines with separators
  let grandTotal = 0;

  for (const tipoKey in acumulador) {
    const tipoTotal = formataValor(acumulador[tipoKey].total);
    // Add a separator line for Tipo groups except first
    if (resumoDetalhadoDiv.childElementCount > 0) {
      const hr = document.createElement("hr");
      hr.style.border = "none";
      hr.style.borderTop = "1px solid #cccccc";
      hr.style.margin = "10px 0";
      resumoDetalhadoDiv.appendChild(hr);
    }
    resumoDetalhadoDiv.appendChild(createRow(tipoKey.toUpperCase(), tipoTotal, { bold: true, marginBottom: "6px" }));

    const familias = acumulador[tipoKey].familias;
    for (const famKey in familias) {
      const famTotal = formataValor(familias[famKey].total);
      resumoDetalhadoDiv.appendChild(createRow("‚îî " + famKey, famTotal, { fontSize: "0.875rem", paddingLeft: "1rem", marginBottom: "4px" }));

      const nomes = familias[famKey].nomes;
      for (const nomeKey in nomes) {
        const nomeTotal = formataValor(nomes[nomeKey]);
      resumoDetalhadoDiv.appendChild(createRow("   ‚îî " + nomeKey, nomeTotal, { paddingLeft: "2rem", marginBottom: "2px", bold: true }));
      }

      // Add Familia subtotal separator line with background
      const famSubtotalContainer = document.createElement("div");
      famSubtotalContainer.style.backgroundColor = "rgba(204, 204, 204, 0.1)";
      famSubtotalContainer.style.padding = "2px 6px";
      famSubtotalContainer.style.marginBottom = "10px";
      famSubtotalContainer.style.borderRadius = "4px";
      
      const famSubtotalHr = document.createElement("hr");
      famSubtotalHr.style.border = "none";
      famSubtotalHr.style.borderTop = "1px dotted #cccccc";
      famSubtotalHr.style.margin = "0 0 0 1rem";
      famSubtotalContainer.appendChild(famSubtotalHr);

      resumoDetalhadoDiv.appendChild(famSubtotalContainer);
    }

    grandTotal += acumulador[tipoKey].total;
  }

  // Add grand total line after all Tipos with background
  const grandTotalContainer = document.createElement("div");
  grandTotalContainer.style.backgroundColor = "rgba(204, 204, 204, 0.2)";
  grandTotalContainer.style.borderRadius = "6px";
  grandTotalContainer.style.padding = "6px 10px";
  grandTotalContainer.style.margin = "12px 0";

  // Removed grand total separator <hr> line as per request
  /*
  const grandTotalHr = document.createElement("hr");
  grandTotalHr.style.border = "none";
  grandTotalHr.style.borderTop = "2px solid #cccccc";
  grandTotalHr.style.margin = "0 0 6px 0";

  grandTotalContainer.appendChild(grandTotalHr);
  */

  grandTotalContainer.appendChild(createRow("TOTAL", formataValor(grandTotal), { bold: true, marginBottom: "0" }));

  resumoDetalhadoDiv.appendChild(grandTotalContainer);

  // Also update the displayed report table to show only filtered data
  // const relatorioContainer = document.getElementById("relatorioContainer");
  relatorioContainer.innerHTML = ""; // clear existing table

  const table = document.createElement("table");
  table.className = "w-full text-left border-collapse";
  table.style.border = "none"; // Remove outer border

  const thead = document.createElement("thead");
  const headerRow = document.createElement("tr");
  // Reduced header cell padding for tighter rows
  const headerCellPadding = "4px 6px";

  const keys = Object.keys(filtered[0]);
  keys.forEach(key => {
    const th = document.createElement("th");
    th.textContent = key;
    th.style.border = "none"; // Remove border for cleaner look
    th.style.padding = headerCellPadding;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  // Reduced cell padding for tighter row spacing
  const cellPadding = "4px 6px";
  filtered.forEach(row => {
    const tr = document.createElement("tr");
    keys.forEach(key => {
      const td = document.createElement("td");
      td.textContent = row[key];
      td.style.border = "none"; 
      td.style.padding = cellPadding;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);

  relatorioContainer.appendChild(table);
}

document.getElementById("relatorioMesSelector").addEventListener("change", (e) => {
  const mes = e.target.value;
  if (window.financeiroRelatorioData) {
    atualizarDashboard(mes);
  }
});
</script>










</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyrQlcKg1G6S24Cb7Hw9774O7yjMpvEf1Cce8DNjcEt1U27iVVq5SUAlRJFxWJwiFBaVw/exec";

let editingIndex = -1;

function salvarCliente(cliente) {
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  if (editingIndex >= 0) {
    clientes[editingIndex] = cliente;
    editingIndex = -1;
  } else {
    clientes.push(cliente);
  }
  localStorage.setItem('clientes', JSON.stringify(clientes));
}

function editarCliente(index) {
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  const cli = clientes[index];
  document.getElementById('clienteNome').value = cli.nome || '';
  document.getElementById('clienteCpf').value = cli.cpf || '';
  document.getElementById('clienteTelefone').value = cli.telefone || '';
  document.getElementById('clienteDn').value = cli.dn || '';
  document.getElementById('clienteEnderecoNum').value = cli.endereco_num || '';
  document.getElementById('clienteCep').value = cli.cep || '';
  document.getElementById('clienteInstagram').value = cli.instagram || '';
  document.getElementById('clienteStatus').value = cli.status || 'Ativo';
  document.getElementById('tituloCliente').textContent = 'Editar Cliente';
  editingIndex = index;
  document.getElementById('boxCliente').classList.remove('hidden');
}

function excluirCliente(index) {
  if (confirm('Tem certeza que deseja excluir este cliente?')) {
    let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    clientes.splice(index, 1);
    localStorage.setItem('clientes', JSON.stringify(clientes));
    carregarClientes();
  }
}

function carregarClientes(){
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  let filteredClientes = [...clientes];
  const filtro = document.querySelector('input[name="filtroStatus"]:checked').value;
  if (filtro !== 'todos') {
    filteredClientes = clientes.filter(cli => cli.status === filtro);
  }
  const container = document.getElementById("listaClientes");
  container.innerHTML = "";
  filteredClientes.forEach((cli)=>{
    const originalIndex = clientes.indexOf(cli);
    const card = document.createElement("div");
    card.className = "flex items-center bg-[#2b2b2b] text-[#f5c5b5] shadow-md rounded-xl p-4 w-full max-w-3xl mb-4";
    card.innerHTML = `
      <!-- Esquerda: Avatar e informa√ß√µes -->
      <div class="flex items-center gap-4 flex-1">
        <!-- Avatar -->
        <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#f5c5b5] text-[#1e1e1e] text-xl font-semibold border-2 border-[#f5c5b5]">
          ${cli.nome ? cli.nome.charAt(0).toUpperCase() : 'U'}
        </div>

        <!-- Informa√ß√µes -->
        <div>
          <h2 class="font-semibold text-[#f5c5b5]">${cli.nome || 'Nome n√£o informado'} <span class="inline-block w-3 h-3 rounded-full ${cli.status === 'Ativo' ? 'bg-green-500' : 'bg-red-500'}"></span></h2>
          <div class="text-xs text-[#f5c5b5]/80">
            <p>
              <span class="block">${cli.instagram ? '@' + cli.instagram : 'Instagram n√£o informado'}</span>
              <span class="block">üìû ${cli.telefone || 'Telefone n√£o informado'}</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Centro: Dados adicionais -->
      <div class="text-xs text-[#f5c5b5] text-right flex-1 mx-4">
        <p>${cli.dn ? new Date(cli.dn).toLocaleDateString('pt-BR') : 'DN n√£o informado'} &nbsp;&nbsp;&nbsp; CEP ${cli.cep || 'n√£o informado'}</p>
        <p>${cli.endereco_num || 'Endere√ßo n√£o informado'}</p>
      </div>

      <!-- Direita: Bot√µes -->
      <div class="w-1/5 flex flex-col gap-2">
        <div class="grid grid-cols-2 gap-1">
          <!-- WhatsApp -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-full p-2 text-xs" onclick="window.open('https://wa.me/55${cli.telefone}','_blank')">
            <i class="fab fa-whatsapp text-[#f5c5b5]"></i>
          </button>

          <!-- Editar -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-md p-2 text-xs" onclick="editarCliente(${originalIndex})">
            <i class="fas fa-edit text-[#f5c5b5]"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-1">
          <!-- Excluir -->
          <button class="flex items-center justify-center bg-[#2b2b2b] hover:bg-[#3a3a3a] text-[#f5c5b5] rounded-md p-2 text-xs" onclick="excluirCliente(${originalIndex})">
            <i class="fas fa-trash text-[#f5c5b5]"></i>
          </button>

          <!-- Anamnese -->
          <button class="flex items-center justify-center bg-[#f5c5b5]/20 hover:bg-[#f5c5b5]/30 text-[#f5c5b5] rounded-md p-2 text-xs" onclick="alert('Anamnese de ${cli.nome}')">
            <i class="fas fa-clipboard text-[#f5c5b5]"></i>
          </button>
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded", function() {
    // L√≥gica para mostrar/esconder o formul√°rio dentro do bot√£o
  const btnAnamnese = document.getElementById("btnAnamnese");
  const boxAnamnese = document.getElementById("boxAnamnese");
  btnAnamnese.addEventListener("click", function(e) {
    e.stopPropagation();
    boxAnamnese.classList.toggle("hidden");
  });
  document.addEventListener("click", function(e) {
    if (!boxAnamnese.classList.contains("hidden")) {
      const isClickInside = boxAnamnese.contains(e.target) || btnAnamnese.contains(e.target);
      if (!isClickInside) boxAnamnese.classList.add("hidden");
    }
  });
  document.getElementById("fecharBoxAnamnese").addEventListener("click", function() {
    boxAnamnese.classList.add("hidden");
  });

  // Add toggle for Ocorr√™ncia form similar to Anamnese and Clientes
  const btnAdicionarOcorrencia = document.getElementById("btnAdicionarOcorrencia");
  const boxFinanceiro2 = document.getElementById("boxFinanceiro2");
  btnAdicionarOcorrencia.addEventListener("click", function(e) {
    e.stopPropagation();
    boxFinanceiro2.classList.toggle("hidden");
  });
  document.addEventListener("click", function(e) {
    if (!boxFinanceiro2.classList.contains("hidden")) {
      const isClickInside = boxFinanceiro2.contains(e.target) || btnAdicionarOcorrencia.contains(e.target);
      if (!isClickInside) boxFinanceiro2.classList.add("hidden");
    }
  });
  document.getElementById("fecharBoxFinanceiro2").addEventListener("click", function() {
    boxFinanceiro2.classList.add("hidden");
  });
    document.getElementById("formAnamneseBox").addEventListener("submit", function(e) {
      e.preventDefault();
      alert("‚úÖ Anamnese salva!");
      boxAnamnese.classList.add("hidden");
      this.reset();
    });
    // L√≥gica para mostrar/esconder o formul√°rio de cliente
    const btnAdicionarCliente = document.getElementById("btnAdicionarCliente");
    const boxCliente = document.getElementById("boxCliente");
    btnAdicionarCliente.addEventListener("click", function(e) {
      e.stopPropagation();
      editingIndex = -1;
      document.getElementById('formCliente').reset();
      document.getElementById('tituloCliente').textContent = 'Cadastro de Cliente';
      boxCliente.classList.toggle("hidden");
    });
    document.addEventListener("click", function(e) {
      if (!boxCliente.classList.contains("hidden")) {
        const isClickInside = boxCliente.contains(e.target) || btnAdicionarCliente.contains(e.target);
        if (!isClickInside) boxCliente.classList.add("hidden");
      }
    });
    document.getElementById("fecharBoxCliente").addEventListener("click", function() {
      boxCliente.classList.add("hidden");
    });
    document.getElementById("formCliente").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const cliente = {
        nome: formData.get('nome'),
        cpf: formData.get('cpf'),
        telefone: formData.get('telefone'),
        dn: formData.get('dn'),
        endereco_num: formData.get('endereco_num'),
        cep: formData.get('cep'),
        instagram: formData.get('instagram'),
        status: formData.get('status')
      };
      salvarCliente(cliente);
      alert("‚úÖ Cliente salvo!");
      boxCliente.classList.add("hidden");
      this.reset();
      carregarClientes();
    });

  const sidebar = document.getElementById("sidebar");
  const menuBtn = document.getElementById("menuBtn");
  menuBtn.addEventListener("click", function(e) {
    sidebar.classList.toggle("hidden");
    e.stopPropagation();
  });

  // Fecha o menu ao clicar fora da sidebar ou do bot√£o
  document.addEventListener("click", function(e) {
    if (!sidebar.classList.contains("hidden")) {
      const isClickInsideSidebar = sidebar.contains(e.target);
      const isClickOnMenuBtn = menuBtn.contains(e.target);
      if (!isClickInsideSidebar && !isClickOnMenuBtn) {
        sidebar.classList.add("hidden");
      }
    }
  });
  const pages = document.querySelectorAll(".page");
  document.querySelectorAll(".sidebar a").forEach(a=>{
    a.addEventListener("click", e=>{
      e.preventDefault();
      pages.forEach(p=>p.classList.add("hidden"));
      document.getElementById(a.dataset.page+"Page").classList.remove("hidden");
      document.querySelectorAll(".sidebar a").forEach(x=>x.classList.remove("active"));
      a.classList.add("active");
      if(a.dataset.page==="clientes") carregarClientes();
      if(a.dataset.page==="home") renderHomeCalendar();
      if(a.dataset.page==="financeiro2") {
        // Automatically trigger clicking the "Relat√≥rio" button to load the report
        const btnLoadRelatorio = document.getElementById("btnLoadRelatorio");
        if (btnLoadRelatorio) {
          btnLoadRelatorio.click();
          // Hide the "Relat√≥rio" button after auto-loading the report
          btnLoadRelatorio.style.display = "none";
        }
      }
    });
  });

  let homeCalendar;
  function renderHomeCalendar() {
    const calendarEl = document.getElementById("calendar");
    if (!calendarEl) return;
    if (homeCalendar) {
      homeCalendar.destroy();
    }
    homeCalendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      dateClick: info => {
        const nome = prompt("Nome do Cliente:");
        if (nome) addAgendamento(info.dateStr, nome);
      }
    });
    homeCalendar.render();
  }
  renderHomeCalendar();

  const agendaCalendar = new FullCalendar.Calendar(document.getElementById("calendarAgenda"), {
    initialView:"dayGridMonth"
  });
  agendaCalendar.render();

  async function addAgendamento(data, cliente){
    const agendamento={tipo:"agendamento",data,hora:"09:00",cliente,servico:"C√≠lios"};
    await fetch(API_URL,{method:"POST",body:JSON.stringify(agendamento),headers:{"Content-Type":"application/json"}});
    alert("‚úÖ Agendamento salvo!");
    atualizarHome();
  }

  async function atualizarHome(){
    const res=await fetch(API_URL);
    const data=await res.json();
    document.getElementById("atendimentos").innerText=`Atendimentos: ${data.agendamentos?.length||0}`;
  }
});

function handleFinanceiro2Submit(event) {
  event.preventDefault();
  alert("Registrado com sucesso.");
  return false; // prevent default form submission to stay on page
}
</script>
</body>
</script>
